#!/usr/bin/env ruby

require 'fuffa'
require 'optparse'
require 'uri'

options = {
  :url => "",
  :wordlist => ""
}

option_parse = OptionParser.new do |opt|
  opt.on '-u', '--url URL', 'url to be fuzzed' do |url|
    if url =~ URI::regexp
      if url.include? "FUZZ"
        options[:url] = url
      else 
        abort "Url doesn't contain FUZZ keyword."
      end
    else 
      abort "Not a valid url."
    end
  end

  opt.on '-w', '--wordlist WORDLIST', 'wordlist used to fuzz' do |wl|
    if File.exists? wl 
      if File.readable? wl
        options[:wordlist] = wl
      else
        abort "Wordlist given is not readable. Check permissions and retry."
      end
    else
      abort "Wordlist provided doesn't exist."
    end
  end

  opt.on '-h', '--help' do
    puts opt
    exit
  end
end
option_parse.parse!

if options[:wordlist] == "" or options[:url] == ""
  abort option_parse.help
end

fuzzer = Fuffa::Fuzzer.new(options[:url], options[:wordlist])
fuzzer.fuzz()
Fuffa::Utils.put_table(fuzzer)
